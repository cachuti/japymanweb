<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Box Zone TV</title>
<style>
body{background:#0f172a;color:#e2e8f0;font-family:'Roboto',sans-serif;margin:0;padding:20px;display:flex;flex-direction:column;overflow-x:hidden;}
h1{font-size:40px;text-align:center;margin-bottom:25px;color:#fff;}
h2{font-size:28px;margin-top:35px;margin-bottom:15px;color:#cbd5e1;padding-left:10px;border-bottom:2px solid #2d3748;}
.fila{display:flex;gap:7.5px;overflow-x:auto;margin-bottom:12.5px;padding-bottom:5px;scroll-behavior:smooth;}
.fila::-webkit-scrollbar{height:4px;}
.fila::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2);border-radius:2px;}
.item{flex-shrink:0;width:200px;background:#1f2937;padding:6px;border-radius:6px;text-align:center;cursor:pointer;transition:transform .3s,border .3s;white-space:normal;position:relative;border:2px solid transparent;}
.item img{width:100%;height:160px;object-fit:cover;border-radius:5px;}
.item p{margin:6px 0 0;font-size:16px;font-weight:400;color:#cbd5e1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.item:focus{outline:none;transform:scale(1.15);border:2px solid #00aaff;z-index:10;}
</style>
</head>
<body>
<h1>Box Zone TV</h1>
<div id="contenido"></div>

<script src="https://www.gstatic.com/firebasejs/8.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.1.0/firebase-database.js"></script>
<script>
var firebaseConfig = {
    apiKey: "AIzaSyD6Tj5S2TvV_k8jq0P4ET_Mxo_YgoWtBwo",
    authDomain: "chunito-d25bb.firebaseapp.com",
    projectId: "chunito-d25bb",
    databaseURL: "https://chunito-d25bb-default-rtdb.firebaseio.com",
    storageBucket: "chunito-d25bb.appspot.com",
    messagingSenderId: "748622352005",
    appId: "1:748622352005:web:f9ea6d2da8af92f76123ec"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();
var ref = db.ref("novedades");
var contenedor = document.getElementById("contenido");

var estructura=[], itemsFocus=[], filaFocus=0, itemFocus=0;

// Función PIN
function pedirPin(callback){
    let pin = prompt("Este contenido está protegido. Ingresa el PIN de 3 dígitos:");
    if(pin==="123"){ callback(); } 
    else { alert("PIN incorrecto"); }
}

// Cargar contenido
ref.on("value", snapshot => {
    contenedor.innerHTML="";
    estructura=[]; itemsFocus=[];
    snapshot.forEach(child=>{
        var data = child.val();
        if(data.subtitulo) estructura.push({subtitulo:data.subtitulo, items:[]});
        else if(data.titulo && estructura.length>0) estructura[estructura.length-1].items.push(data);
    });
    estructura.forEach((bloque,bIndex)=>{
        var subtitulo=document.createElement("h2"); subtitulo.textContent=bloque.subtitulo; contenedor.appendChild(subtitulo);
        var fila=document.createElement("div"); fila.className="fila"; var itemsEnFila=[];
        bloque.items.forEach((item,iIndex)=>{
            var div=document.createElement("div"); div.className="item"; div.setAttribute("tabindex","0"); 
            div.dataset.fila=bIndex; div.dataset.item=iIndex;
            div.dataset.url=item.url;
            div.dataset.protegido=item.protegido||false;
            var img=document.createElement("img"); img.src=item.imagen;
            var desc=document.createElement("p"); desc.textContent=item.descripcion||item.titulo||"";
            div.appendChild(img); div.appendChild(desc); fila.appendChild(div);
            itemsEnFila.push(div);
        });
        contenedor.appendChild(fila);
        itemsFocus.push(itemsEnFila);
    });

    // Restaurar foco
    if(itemsFocus[filaFocus] && itemsFocus[filaFocus][itemFocus]) itemsFocus[filaFocus][itemFocus].focus();
});

// Navegación con teclado/control remoto
document.addEventListener('keydown', e => {
    if(itemsFocus.length===0) return;
    var nextFila=filaFocus, nextItem=itemFocus;
    if(e.key==="ArrowRight") nextItem=Math.min(itemFocus+1, itemsFocus[filaFocus].length-1);
    else if(e.key==="ArrowLeft") nextItem=Math.max(itemFocus-1,0);
    else if(e.key==="ArrowDown") { if(filaFocus<itemsFocus.length-1){ nextFila=filaFocus+1; nextItem=Math.min(itemFocus, itemsFocus[nextFila].length-1); } }
    else if(e.key==="ArrowUp") { if(filaFocus>0){ nextFila=filaFocus-1; nextItem=Math.min(itemFocus, itemsFocus[nextFila].length-1); } }
    else if(e.key==="Enter"||e.key===" ") {
        var el = itemsFocus[filaFocus][itemFocus];
        if(el.dataset.protegido==="true"){ pedirPin(()=>window.open(el.dataset.url,"_blank")); }
        else{ window.open(el.dataset.url,"_blank"); }
        e.preventDefault(); return;
    } else return;

    filaFocus=nextFila; itemFocus=nextItem;
    var nextEl = itemsFocus[filaFocus][itemFocus];
    if(nextEl){
        nextEl.focus();
        var container = nextEl.closest('.fila');
        if(container){
            var itemRect=nextEl.getBoundingClientRect();
            var containerRect=container.getBoundingClientRect();
            if(itemRect.left<containerRect.left) container.scrollLeft-=(containerRect.left-itemRect.left)+20;
            else if(itemRect.right>containerRect.right) container.scrollLeft+=(itemRect.right-containerRect.right)+20;
        }
    }
    e.preventDefault();
});
</script>
</body>
</html>
