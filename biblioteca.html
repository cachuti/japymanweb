<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Box Zone Películas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        :root {
            --color-bg-dark: #0f172a;
            --color-bg-medium: #1e293b;
            --color-text-light: #e2e8f0;
            --color-text-dim: #94a3b8;
            --color-focus-glow: #0ea5e9;
        }

        body {
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0 20px;
            overflow-x: hidden;
        }

        .top-section {
            position: sticky;
            top: 0;
            background-color: var(--color-bg-dark);
            padding: 20px 0 0 0;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        h1 {
            font-size: 40px;
            margin-bottom: 25px;
            text-align: center;
            color: #fff;
            font-weight: 700;
        }

        #category-carousel {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
        }

        #category-carousel::-webkit-scrollbar {
            height: 8px;
        }
        #category-carousel::-webkit-scrollbar-thumb {
            background: var(--color-bg-medium);
            border-radius: 10px;
        }

        .category-button {
            flex-shrink: 0;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 20px;
            border: 2px solid transparent;
            background-color: #3b82f6;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
        }

        .category-button:focus, .category-button.active {
            background-color: #ffffff;
            color: #000;
            border-color: #ffffff;
        }
        
        .fila {
            display: flex;
            overflow-x: auto;
            margin-bottom: 25px;
            padding-bottom: 10px;
            gap: 15px;
        }

        .fila::-webkit-scrollbar {
            height: 8px;
        }
        .fila::-webkit-scrollbar-thumb {
            background: var(--color-bg-medium);
            border-radius: 10px;
        }
        .fila::-webkit-scrollbar-track {
            background: var(--color-bg-dark);
        }

        .item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--color-bg-medium);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s ease, border 0.2s ease;
        }

        .item:focus {
            outline: none;
            border-color: var(--color-focus-glow);
            transform: scale(1.05);
        }

        .item img {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .item .item-title {
            margin: 0 0 10px;
            font-size: 16px;
            font-weight: 400;
            color: var(--color-text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        /* --- Estilos de la Ventana Modal --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-bg-medium);
            border-radius: 12px;
            padding: 40px;
            max-width: 80%;
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }
        
        .modal-image {
            width: 200px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .modal-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-details h3 {
            font-size: 36px;
            margin: 0;
            color: #fff;
        }

        .modal-details p {
            font-size: 18px;
            line-height: 1.5;
            color: var(--color-text-dim);
            max-height: 300px;
            overflow-y: auto;
        }

        .modal-actions {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        /* Cambiado de button a ancla para el botón de Reproducir */
        .modal-button {
            display: inline-block;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none; /* Para los enlaces */
            text-align: center;
        }

        .modal-button.play {
            background-color: var(--color-focus-glow);
            color: #fff;
        }
        
        .modal-button.back {
            background-color: #4b5563;
            color: #fff;
        }
        
        .modal-button:focus {
            outline: none;
            background-color: #ffffff;
            color: #000;
            box-shadow: none;
            border-color: #fff;
        }
        
        /* --- Estilos de la Política de Privacidad --- */
        .privacy-section {
            background-color: var(--color-bg-medium);
            padding: 25px;
            margin-top: 50px;
            border-radius: 12px;
            color: var(--color-text-dim);
        }

        .privacy-section h3 {
            font-size: 24px;
            margin-top: 0;
            color: #fff;
            border-bottom: 1px solid #4b5563;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .privacy-section p {
            font-size: 16px;
            line-height: 1.6;
        }

        /* --- Estilos del pie de página dentro de la sección de privacidad --- */
        .privacy-section footer {
            text-align: center;
            padding: 10px 0 0 0;
            margin-top: 10px;
            font-size: 14px;
            color: var(--color-text-dim);
            border-top: 1px solid #4b5563;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="top-section">
        <h1 id="main-title">Box Zone Películas</h1>
        <div id="category-carousel"></div>
    </div>
    
    <div class="content-section">
        <div id="contenido"></div>
    </div>

    <div class="privacy-section">
        <h3>Política de Privacidad</h3>
        <p>
            En Box Zone Películas, valoramos su privacidad. Esta política describe cómo se recopila, utiliza y protege su información. Al utilizar esta aplicación, usted acepta los términos descritos a continuación.
            No recopilamos información personal de identificación, como nombres, direcciones de correo electrónico o números de teléfono. La aplicación solo accede a los enlaces de videos para su reproducción, y no guarda ningún historial de visualización ni comparte datos con terceros. Todos los videos provienen de fuentes externas y Box Zone Películas no aloja ningún contenido en sus servidores.
        </p>
        <footer>
            <p>© 2025 Box Zone Películas. Todos los derechos reservados.</p>
        </footer>
    </div>

    <div id="modal-pelicula" class="modal">
        <div class="modal-content">
            <img id="modal-imagen" class="modal-image" src="" alt="Imagen de la película">
            <div class="modal-details">
                <h3 id="modal-titulo"></h3>
                <p id="modal-descripcion"></p>
                <div class="modal-actions">
                    <a id="btn-reproducir" class="modal-button play" tabindex="0" href="#" target="_blank">Reproducir</a>
                    <button id="btn-volver" class="modal-button back" tabindex="0">Volver</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyD6Tj5S2TvV_k8jq0P4ET_Mxo_YgoWtBwo",
            authDomain: "chunito-d25bb.firebaseapp.com",
            projectId: "chunito-d25bb",
            databaseURL: "https://chunito-d25bb-default-rtdb.firebaseio.com",
            storageBucket: "chunito-d25bb.appspot.com",
            messagingSenderId: "748622352005",
            appId: "1:748622352005:web:f9ea6d2da8af92f76123ec"
        };

        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var ref = db.ref("box-zone-estrenos");
        var contenedor = document.getElementById("contenido");
        var categoryCarousel = document.getElementById("category-carousel");
        var mainTitle = document.getElementById("main-title");
        var modal = document.getElementById("modal-pelicula");
        // btnReproducir ahora es un enlace
        var btnReproducir = document.getElementById("btn-reproducir");
        var btnVolver = document.getElementById("btn-volver");

        var itemsFocus = [];
        var categoryButtons = [];
        var filaFocus = 0;
        var itemFocus = 0;
        var isModalActive = false;
        var lastFocusedElement = null;
        var activeCategoryKey = null;

        function renderCategoryButtons(categories) {
            categoryCarousel.innerHTML = "";
            categoryButtons = [];
            
            categories.forEach(function(category) {
                var button = document.createElement('button');
                button.className = "category-button";
                button.textContent = category.subtitulo;
                button.setAttribute('data-key', category.key);
                button.setAttribute('data-title', category.subtitulo);
                button.setAttribute('tabindex', '0');

                button.addEventListener('click', function() {
                    lastFocusedElement = button;
                    showMoviesForCategory(category.key, category.subtitulo);
                });

                categoryCarousel.appendChild(button);
                categoryButtons.push(button);
            });
            
            if (categories.length > 0) {
                activeCategoryKey = categories[0].key;
                showMoviesForCategory(categories[0].key, categories[0].subtitulo);
            }
        }

        function showMoviesForCategory(categoryKey, categoryTitle) {
            activeCategoryKey = categoryKey;
            mainTitle.textContent = "Box Zone Películas";
            contenedor.innerHTML = "";
            itemsFocus = [];

            categoryButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-key') === categoryKey) {
                    btn.classList.add('active');
                    btn.focus();
                }
            });

            var categoryRef = db.ref("box-zone-estrenos/" + categoryKey);
            categoryRef.once("value").then(function(snapshot) {
                let htmlString = `<div class="fila">`;
                snapshot.forEach(function(itemSnapshot) {
                    if (itemSnapshot.key !== "subtitulo") {
                        var itemData = itemSnapshot.val();
                        htmlString += `
                            <div class="item" tabindex="0" data-titulo="${itemData.titulo}" data-descripcion="${itemData.descripcion}" data-imagen="${itemData.imagen}" data-url="${itemData.url}">
                                <img src="${itemData.imagen}" alt="${itemData.titulo}" width="200" height="150" loading="lazy">
                                <p class="item-title">${itemData.titulo || ""}</p>
                            </div>
                        `;
                    }
                });
                htmlString += "</div>";
                contenedor.innerHTML = htmlString;

                let movieItems = document.querySelectorAll('.item');
                itemsFocus = [[...movieItems]];
                
                movieItems.forEach(item => {
                    item.addEventListener('click', function() {
                        lastFocusedElement = item;
                        let data = {
                            titulo: item.getAttribute('data-titulo'),
                            descripcion: item.getAttribute('data-descripcion'),
                            imagen: item.getAttribute('data-imagen'),
                            url: item.getAttribute('data-url')
                        };
                        openModal(data);
                    });
                });

                if (itemsFocus.length > 0 && itemsFocus[0].length > 0) {
                    itemsFocus[0][0].focus();
                }
            });
        }

        ref.on("value", function(snapshot) {
            const categories = [];
            snapshot.forEach(function(categorySnapshot) {
                const categoryData = categorySnapshot.val();
                if (categoryData.subtitulo) {
                    categories.push({ key: categorySnapshot.key, subtitulo: categoryData.subtitulo });
                }
            });
            renderCategoryButtons(categories);
        });

        function openModal(itemData) {
            document.getElementById("modal-imagen").src = itemData.imagen;
            document.getElementById("modal-titulo").textContent = itemData.titulo;
            document.getElementById("modal-descripcion").textContent = itemData.descripcion;
            
            // Asigna la URL del video directamente al atributo href del enlace
            btnReproducir.href = itemData.url;
            
            modal.classList.add("active");
            isModalActive = true;
            btnReproducir.focus();
        }

        function closeModal() {
            modal.classList.remove("active");
            isModalActive = false;
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        }
        
        btnVolver.onclick = closeModal;
        
        document.addEventListener('keydown', function(e) {
            e.preventDefault();

            if (isModalActive) {
                if (e.key === "ArrowRight") {
                    btnVolver.focus();
                } else if (e.key === "ArrowLeft") {
                    btnReproducir.focus();
                } else if (e.key === "Enter" || e.key === " " || e.keyCode === 13) {
                    document.activeElement.click();
                } else if (e.key === "Escape" || e.key === "Backspace") {
                    closeModal();
                }
            } else {
                let currentFocus = document.activeElement;
                let nextElement;
                let isFocusOnCategoryCarousel = categoryCarousel.contains(currentFocus);
                let isFocusOnMovieGrid = itemsFocus.length > 0 && itemsFocus[0].includes(currentFocus);
                
                if (e.key === "Enter" || e.key === " " || e.keyCode === 13) {
                    if (isFocusOnCategoryCarousel) {
                        const categoryKey = currentFocus.getAttribute('data-key');
                        const categoryTitle = currentFocus.getAttribute('data-title');
                        showMoviesForCategory(categoryKey, categoryTitle);
                    } else if (isFocusOnMovieGrid) {
                        currentFocus.click();
                    }
                    return;
                }
                
                if (isFocusOnCategoryCarousel) {
                    if (e.key === "ArrowRight") {
                        let currentIndex = categoryButtons.findIndex(btn => btn === currentFocus);
                        nextElement = categoryButtons[Math.min(categoryButtons.length - 1, currentIndex + 1)];
                    } else if (e.key === "ArrowLeft") {
                        let currentIndex = categoryButtons.findIndex(btn => btn === currentFocus);
                        nextElement = categoryButtons[Math.max(0, currentIndex - 1)];
                    } else if (e.key === "ArrowDown") {
                        if (itemsFocus.length > 0 && itemsFocus[0].length > 0) {
                            nextElement = itemsFocus[0][0];
                        }
                    }
                } else if (isFocusOnMovieGrid) {
                    var nextFila = filaFocus;
                    var nextItem = itemFocus;

                    if (e.key === "ArrowRight") {
                        nextItem = Math.min(itemsFocus[filaFocus].length - 1, itemFocus + 1);
                    } else if (e.key === "ArrowLeft") {
                        nextItem = Math.max(0, itemFocus - 1);
                    } else if (e.key === "ArrowDown") {
                        nextFila = Math.min(itemsFocus.length - 1, filaFocus + 1);
                        if (itemFocus >= itemsFocus[nextFila].length) {
                            nextItem = itemsFocus[nextFila].length - 1;
                        }
                    } else if (e.key === "ArrowUp") {
                        if (filaFocus === 0 && categoryButtons.length > 0) {
                            const activeCategoryButton = categoryButtons.find(btn => btn.getAttribute('data-key') === activeCategoryKey);
                            nextElement = activeCategoryButton || categoryButtons[0];
                        } else {
                            nextFila = Math.max(0, filaFocus - 1);
                            if (itemFocus >= itemsFocus[nextFila].length) {
                                nextItem = itemsFocus[nextFila].length - 1;
                            }
                        }
                    }
                }
                
                if (nextElement) {
                    nextElement.focus();
                    if (nextElement.closest('#category-carousel')) {
                                nextElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                } else if (isFocusOnMovieGrid && (nextFila !== filaFocus || nextItem !== itemFocus)) {
                    filaFocus = nextFila;
                    itemFocus = nextItem;
                    nextElement = itemsFocus[filaFocus][itemFocus];
                    if (nextElement) {
                        nextElement.focus();
                        nextElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                }
            }
        });

        // Configurar el foco inicial en el primer botón de categoría al cargar la página
        window.onload = () => {
            if (categoryButtons.length > 0) {
                categoryButtons[0].focus();
            }
        };

    </script>
</body>
</html>

