<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Box Zone IPTV</title>
<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.6/dist/shaka-player.compiled.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  body { background:#000; color:#fff; font-family:sans-serif; margin:0; overflow:hidden; }
  #playerContainer { position:fixed; top:0; width:100%; height:40vh; background:#111; z-index:5; }
  video { width:100%; height:100%; background:#000; }
  #grid { position:absolute; top:40vh; width:100%; height:60vh; overflow-y:auto;
          display:grid; grid-template-columns:repeat(auto-fill,150px); gap:10px; padding:10px; }
  .canal { width:150px; height:150px; background:#222; border-radius:10px; text-align:center;
           display:flex; flex-direction:column; justify-content:center; align-items:center; cursor:pointer; }
  .canal img { width:100px; height:100px; border-radius:10px; }
  .canal:focus { outline:3px solid #00f; }
  #titulo { position:fixed; top:5px; left:10px; font-size:18px; z-index:10; font-weight:bold; }
  #refreshBtn { position:fixed; top:5px; right:10px; z-index:10; background:#00f; color:#fff; border:none;
                padding:10px 15px; border-radius:10px; cursor:pointer; font-weight:bold; }
</style>
</head>
<body>

<div id="titulo">ðŸ“º Box Zone IPTV</div>
<button id="refreshBtn">ðŸ”„ Refrescar</button>

<div id="playerContainer">
  <video id="video" autoplay controls></video>
</div>

<div id="grid"></div>

<script>
// ðŸ”¹ ConfiguraciÃ³n de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyD6Tj5S2TvV_k8jq0P4ET_Mxo_YgoWtBwo",
  authDomain: "chunito-d25bb.firebaseapp.com",
  projectId: "chunito-d25bb",
  storageBucket: "chunito-d25bb.firebasestorage.app",
  messagingSenderId: "748622352005",
  appId: "1:748622352005:web:f9ea6d2da8af92f76123ec",
  measurementId: "G-DC3XNLCX9Z",
  databaseURL: "https://chunito-d25bb-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ Reproductor Shaka
const video = document.getElementById('video');
let player = new shaka.Player(video);

async function reproducir(canal) {
  try {
    const cfg = {
      drm: { clearKeys: canal.key ? Object.fromEntries([canal.key.split(':')]) : {} }
    };
    player.configure(cfg);
    await player.load(canal.url);
    console.log('Reproduciendo:', canal.nombre);
  } catch (e) {
    alert('Error al reproducir: ' + e);
  }
}

// ðŸ”¹ Mostrar canales en cuadrÃ­cula
const grid = document.getElementById('grid');

function cargarCanales(snapshot) {
  grid.innerHTML = '';
  snapshot.forEach(child => {
    const canal = child.val();
    const div = document.createElement('div');
    div.className = 'canal';
    div.tabIndex = 0;
    div.innerHTML = `
      <img src="${canal.logo || ''}">
      <p>${canal.nombre}</p>
    `;
    div.onclick = () => reproducir(canal);
    grid.appendChild(div);
  });
}

// ðŸ”¹ Escuchar nodo IPTV
db.ref('iptv').on('value', cargarCanales);

// ðŸ”¹ BotÃ³n refrescar
document.getElementById('refreshBtn').onclick = () => location.reload();
</script>

</body>
</html>
