<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Box Zone TV</title>
<style>
  body { margin: 0; background: #121212; color: #fff; font-family: Arial, sans-serif; overflow: hidden; }
  .categoria { margin: 20px; }
  .categoria h2 { margin: 0 0 10px 0; font-size: 20px; }
  .canales { display: flex; overflow-x: auto; }
  .canal { flex: 0 0 auto; width: 120px; margin-right: 10px; cursor: pointer; border: 2px solid transparent; border-radius: 8px; }
  .canal img { width: 100%; height: auto; border-radius: 8px; }
  .canal:focus { outline: none; border-color: #0f0; }
  video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; }
</style>
</head>
<body>

<div id="contenido"></div>
<video id="player" controls autoplay></video>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD6Tj5S2TvV_k8jq0P4ET_Mxo_YgoWtBwo",
  authDomain: "chunito-d25bb.firebaseapp.com",
  projectId: "chunito-d25bb",
  storageBucket: "chunito-d25bb.appspot.com",
  messagingSenderId: "748622352005",
  appId: "1:748622352005:web:f9ea6d2da8af92f76123ec",
  measurementId: "G-DC3XNLCX9Z"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const nodo = db.ref('chat');

let ultimoCanal = null;

nodo.on('value', snapshot => {
  const data = snapshot.val();
  if (!data) return;
  const categorias = {};

  Object.values(data).forEach(c => {
    if (!categorias[c.categoria]) categorias[c.categoria] = [];
    categorias[c.categoria].push(c);
  });

  const contenido = document.getElementById('contenido');
  contenido.innerHTML = '';

  for (const [cat, canales] of Object.entries(categorias)) {
    const divCat = document.createElement('div');
    divCat.className = 'categoria';
    const h2 = document.createElement('h2');
    h2.innerText = cat;
    divCat.appendChild(h2);

    const divCanales = document.createElement('div');
    divCanales.className = 'canales';

    canales.forEach((canal, index) => {
      const div = document.createElement('div');
      div.tabIndex = 0;
      div.className = 'canal';
      div.dataset.url = canal.url;

      const img = document.createElement('img');
      img.src = canal.logo || '';
      img.alt = canal.nombre;
      div.appendChild(img);

      div.addEventListener('click', () => reproducir(canal.url));
      div.addEventListener('keydown', e => {
        if (e.key === 'Enter') reproducir(canal.url);
      });

      divCanales.appendChild(div);
      if (ultimoCanal && ultimoCanal === canal.url) {
        setTimeout(() => div.focus(), 100);
      }
    });

    divCat.appendChild(divCanales);
    contenido.appendChild(divCat);
  }
});

const player = document.getElementById('player');
function reproducir(url) {
  player.src = url;
  player.style.display = 'block';
  player.play();
  ultimoCanal = url;
}

// Al presionar 'Back' en TV, salir del video
document.addEventListener('keydown', e => {
  if (e.key === 'Backspace' || e.key === 'Escape') {
    if (player.style.display === 'block') {
      player.pause();
      player.style.display = 'none';
    }
  }
});
</script>

</body>
</html>
